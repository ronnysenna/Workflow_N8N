{"createdAt":"2025-02-22T12:05:18.673Z","updatedAt":"2025-02-22T12:05:18.673Z","id":"1YW9aTbdbXF8pGed","name":"MONIT_VPS","active":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"hours","hoursInterval":12}]}},"id":"2d16dd65-5420-434e-b034-eec8f2f74fb4","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[760,40]},{"parameters":{"command":"docker system prune -a --force"},"id":"ad68728f-042e-4b08-8619-46b934518c45","name":"docker system prune -a","type":"n8n-nodes-base.ssh","typeVersion":1,"position":[940,40]},{"parameters":{"command":"echo \"CPU: $(top -bn1 | grep 'Cpu(s)' | sed 's/.*, *\\([0-9.]*\\)%* id.*/\\1/' | awk '{print 100 - $1\"%\"}'), MEMÓRIA: $(free -m | awk '/Mem:/ { printf(\"%.2f%\"), $3/$2 * 100 }'), HD: $(df -h / | awk 'NR==2 {print $5}')\""},"id":"82708da8-93fc-49d3-a53a-822ea8cb721c","name":"puxa os dados da vps","type":"n8n-nodes-base.ssh","typeVersion":1,"position":[700,260]},{"parameters":{"jsCode":"// Captura o valor de stdout do node anterior\nconst sshOutput = $json[\"stdout\"];\n\n// Extrair as porcentagens de CPU, Memória e HD usando regex\nconst cpuUsageMatch = sshOutput.match(/CPU: (\\d+(\\.\\d+)?)/);\nconst memoryUsageMatch = sshOutput.match(/MEMÓRIA: (\\d+(\\.\\d+)?)/);\nconst hdUsageMatch = sshOutput.match(/HD: (\\d+(\\.\\d+)?)/);\n\nif (cpuUsageMatch && memoryUsageMatch && hdUsageMatch) {\n    const cpu = parseFloat(cpuUsageMatch[1]);\n    const memoria = parseFloat(memoryUsageMatch[1]);\n    const hd = parseFloat(hdUsageMatch[1]);\n\n    // Retornar as porcentagens como um JSON com os itens separados\n    return {\n        cpu,\n        memoria,\n        hd\n    };\n} else {\n    throw new Error(\"Erro: Não foi possível extrair os valores de CPU, Memória e HD\");\n}"},"id":"882705dc-c7c4-4fc8-a93c-e2f8cc562255","name":"Code","type":"n8n-nodes-base.code","typeVersion":2,"position":[940,260]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"7e75fe56-99c8-4e8a-a9b4-ddeb77017bb5","leftValue":"={{ $item(\"0\").$node[\"Code\"].json[\"cpu\"] }}","rightValue":10,"operator":{"type":"number","operation":"gte"}},{"id":"daacb5d3-2569-43e5-afc3-ab5a78e4980e","leftValue":"={{ $item(\"0\").$node[\"Code\"].json[\"memoria\"] }}","rightValue":10,"operator":{"type":"number","operation":"gte"}},{"id":"0b83b92e-1fee-455f-ba51-da4f8ac50ef7","leftValue":"={{ $item(\"0\").$node[\"Code\"].json[\"hd\"] }}","rightValue":10,"operator":{"type":"number","operation":"gte"}}],"combinator":"or"},"looseTypeValidation":true,"options":{}},"id":"2096e903-1cc6-418b-8062-da007ca257b9","name":"If","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,580]},{"parameters":{"content":"\n        ═══════════════════════════════════════════════════════════════\n        ██╗   ██╗██████╗ ███████╗    ██╗   ██╗ ██╗    ██████╗     ██╗\n        ██║   ██║██╔══██╗██╔════╝    ██║   ██║███║   ██╔═████╗   ███║\n        ██║   ██║██████╔╝███████╗    ██║   ██║╚██║   ██║██╔██║   ╚██║\n        ╚██╗ ██╔╝██╔═══╝ ╚════██║    ╚██╗ ██╔╝ ██║   ████╔╝██║    ██║\n         ╚████╔╝ ██║     ███████║     ╚████╔╝  ██║██╗╚██████╔╝██╗ ██║\n          ╚═══╝  ╚═╝     ╚══════╝      ╚═══╝   ╚═╝╚═╝ ╚═════╝ ╚═╝ ╚═╝    \n  \n        ═══════════════════════════════════════════════════════════════\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Monitoramento VPS\n","height":790,"width":1133,"color":4},"id":"f46e8c3c-f61c-4ca2-aba5-617e07a885f2","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0]},{"parameters":{},"name":"Error Trigger","type":"n8n-nodes-base.errorTrigger","position":[60,240],"typeVersion":1,"id":"f3d406bc-e31c-4913-a226-354b5150b596"},{"parameters":{"method":"POST","url":"={{ $json.execution.url }}/message/sendText/agente-teste","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"=74fafdb99f13d4868c92fd98d3171d08f7d4ed8daee8cac0122eea787af84cbf"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"+5585992525311"},{"name":"text","value":"=*N8N Workflow Failure:* {{ $item(\"0\").$node[\"Error Trigger\"].json[\"workflow\"][\"name\"] }}\n*----------------------------------------*\n\n*Workflow:*{{ $json.workflow }} \n*Erro:* {{ $item(\"0\").$node[\"Error Trigger\"].json[\"execution\"][\"error\"][\"message\"] }}\n*Último nó executado:* ?\n*URL de execução:* https://n8n.ronnysenna.com.br/workflow/{{ $item(\"0\").$node[\"Error Trigger\"].json[\"workflow\"][\"id\"] }}\n\n*----------------------------------------*\n🤖 Consulte nossas Soluções de Inteligência Artificial para Whatsapp\n\n© 2024 - {{ $now.format('yyyy') }}, *Ronny Senna* Todos os direitos reservads."},{"name":"delay","value":"={{ 3000 }}"},{"name":"presence","value":"composing"}]},"options":{"redirect":{"redirect":{}}}},"id":"4d0dd081-6c40-41d7-9474-2954c18f2a00","name":"Grupos","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[320,240]},{"parameters":{"resource":"messages-api","instanceName":"evolution","remoteJid":"+5585992525311","messageText":"=📊 Relatório de Uso do Servidor 🚀  \n\n🖥 CPU: {{ $json.cpu }} \n💾 Memória: {{ $json.memoria }}\n📂 HD: {{ $json.hd }}\n\nTudo está dentro dos limites! ✅ ","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[880,480],"id":"c3642750-092c-4c8b-ad45-21cecfafdc0d","name":"Evolution API"},{"parameters":{"resource":"messages-api","instanceName":"evolution","remoteJid":"+5585992525311","messageText":"=🚨 Alerta de Uso Elevado! ⚠️\n\n⚡ CPU: 🔴 {{ $json.cpu }}\n🛑 Memória: 🔴 {{ $json.memoria }}\n📛 HD: 🔴 95% {{ $json.hd }}\n\n⚠️ Atenção! O servidor está com uso elevado. \n🚨 Isso pode causar lentidão ou falhas!  ","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[880,640],"id":"be695ccd-c181-4179-ba6e-0eb506a15027","name":"Evolution API1"}],"connections":{"Schedule Trigger":{"main":[[{"node":"docker system prune -a","type":"main","index":0}]]},"docker system prune -a":{"main":[[{"node":"puxa os dados da vps","type":"main","index":0}]]},"puxa os dados da vps":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Evolution API","type":"main","index":0}],[{"node":"Evolution API1","type":"main","index":0}]]},"Error Trigger":{"main":[[{"node":"Grupos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":null,"versionId":"e4f973fa-b9c4-4fd0-bbee-42df56b5426d","triggerCount":0,"tags":[]}